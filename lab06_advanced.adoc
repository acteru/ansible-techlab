# LAB06 - Advanced tasks using ansible

In this lab we will learn to use more ansible magic!

### Task 1
- Write a `download.yml` playbook which tries to download something from a non-existing URL onto node2.
- The playbook should be able to handle errors. Make the playbook output the message _"Download failed!"_ if
  the `download` task failed. The playbook bust keep on running and shall not exit after this message.
- Output a message at the end of the play informing you the download attempt has finished.

### TASK 2
- Write a playbook which installs multiple yum packages containing a service (f.e. httpd).
- start those services in the same playbook using a loop.

[TIP]
====
 Check if you really need a loop when installing multiple packages.
====

## Solutions

.Solution 1
[%collapsible]
====
[shell]
----
$ cat download.yml
---
- hosts: node2
  become: yes
  tasks:
    - block:
        - name: Download random things from the internet
          get_url:
            url: http://www.asdfasdfasppppakdd.com/file
            dest: /tmp/
      rescue:
        - debug:
            msg: "Download failed!"
      always:
        - debug:
            msg: "Download attempt finished."

$ ansible-playbook download.yml
----
====


.Solution 2
[%collapsible]
====
[shell]
----
$ cat services.yml
---
- name: node1
  become: yes
  tasks:
    - name: install packages
      yum:
        name:
          - httpd
          - chrony
          - audit
        state: present
    - name: start the services
      service:
        name: "{{ item }}"
        state: started
      loop:
        - httpd
        - chronyd
        - auditd
----
====
